<div class="container" *ngIf="isLoading">
  <mat-spinner *ngIf="isLoading"></mat-spinner>
</div>
<div class="container" *ngIf="!isLoading">
  <div class="add-button-header">
    <div class="titleInside">
      <h2>My Fridge - {{ fridge.name }}</h2>
      <button mat-button matTooltip="Edit fridge" class="buttonEdit" [routerLink]="['/fridge/edit', fridge.id]">
        <span class="material-icons mdc-fab__icon">create</span>
      </button>
      <button mat-button matTooltip="Delete fridge" color="warn" (click)="openDialog(fridge.name, fridge.id, 'fridge')">
        <span class="material-icons mdc-fab__icon">delete_outlined</span>
      </button>
    </div>

    <div>
      <button class="mdc-fab mdc-fab--extended" [routerLink]="['/fridge/floor/create']">
        <div class="mdc-fab__ripple"></div>
        <span class="material-icons mdc-fab__icon">add</span>
        <span class="mdc-fab__label">Add Floor</span>
      </button>
    </div>
  </div>
  <div>
    <p>{{ fridge.type }}</p>
  </div>
  <mat-tab-group mat-stretch-tabs *ngIf="floors.length > 0 && !isLoading" [selectedIndex]="selectTabs" (selectedIndexChange)="updateDataSource($event)">
    <mat-tab *ngFor="let floor of floors; let index = index" [label]="floor.name">
      <ng-template matTabContent>
        <div class="add-button-header" style="min-height: 5rem;">
          <div>
            <div>
              <mat-chip-list aria-orientation="horizontal" aria-label="food type" *ngFor="let type of floor.type">
                <mat-chip>{{type}}</mat-chip>
              </mat-chip-list>
              <p>Quantity food: {{ floor.qtyfood }}</p>
            </div>
          </div>
          <div>
            <button mat-button matTooltip="Edit floor" class="buttonEdit"
              [routerLink]="['/fridge/floor/edit', floor.id]">
              <span class="material-icons mdc-fab__icon">create</span>
              <span class="mdc-fab__label">EDIT</span>
            </button>
            <button mat-button matTooltip="Delete floor" color="warn"
              (click)="openDialog(floor.name, floor.id, 'floor')">
              <span class="material-icons mdc-fab__icon">delete_outlined</span>
              <span class="mdc-fab__label">DELETE</span>
            </button>
          </div>
        </div>

        <mat-spinner *ngIf="isLoadingBis"></mat-spinner>
        <div *ngIf="foodList.length > 0 && !isLoadingBis">
          <div class="toggleGroup">
            <mat-button-toggle-group #group="matButtonToggleGroup">
              <mat-button-toggle checked="true" value="grid" aria-label="grid view">
                <span class="material-icons mdc-fab__icon">apps</span>
              </mat-button-toggle>
              <mat-button-toggle value="table" aria-label="table view with details">
                <span class="material-icons mdc-fab__icon">view_headline</span>
              </mat-button-toggle>
              <button mat-button matTooltip="Add element to floor" matTooltipPosition="above"
                [routerLink]="['/fridge/food/create', floor.id]">
                <span class="material-icons mdc-fab__icon">add_circle_outline</span>
                <span class="mdc-fab__label">ADD</span>
              </button>
            </mat-button-toggle-group>
          </div>
          <div *ngIf="group.value == 'table' && !isLoadingBis">
            <mat-form-field>
              <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Filter">
            </mat-form-field>

            <div class="mat-elevation-z8">
              <table mat-table [dataSource]="dataSource" matSort>

                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
                  <td mat-cell *matCellDef="let row"> {{row.name}} </td>
                </ng-container>

                <!-- Progress Column -->
                <ng-container matColumnDef="type">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> Type </th>
                  <td mat-cell *matCellDef="let row"> {{row.type}} </td>
                </ng-container>

                <ng-container matColumnDef="quantity">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> quanity </th>
                  <td mat-cell *matCellDef="let row"> {{row.quantity}}{{row.unit_qty}} </td>
                </ng-container>

                <ng-container matColumnDef="expiration_date">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> expiration date </th>
                  <td mat-cell *matCellDef="let row"> {{row.expiration_date.substring(0,10)}} </td>
                </ng-container>

                <ng-container matColumnDef="date_of_purchase">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> date of purchase </th>
                  <td mat-cell *matCellDef="let row"> {{row.date_of_purchase.substring(0,10)}} </td>
                </ng-container>

                <ng-container matColumnDef="star" stickyEnd>
                  <th mat-header-cell *matHeaderCellDef></th>
                  <td mat-cell *matCellDef="let element">
                    <button mat-button [matMenuTriggerFor]="menu">
                        <span class="material-icons mdc-fab__icon">more_vert</span>
                    </button>
                    <mat-menu #menu="matMenu">
                      <button mat-menu-item matTooltip="Edit floor" class="buttonEdit"
                        [routerLink]="['/fridge/food/edit', element.id]">
                        <span class="material-icons mdc-fab__icon">create</span>
                        <span class="mdc-fab__label">EDIT</span>
                      </button>
                      <button mat-menu-item matTooltip="Delete floor" color="warn"
                        (click)="openDialog(element.name, element.id, 'food')">
                        <span class="material-icons mdc-fab__icon">delete_outlined</span>
                        <span class="mdc-fab__label">DELETE</span>
                      </button>
                    </mat-menu>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;">
                </tr>
              </table>

              <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
            </div>
          </div>

          <div *ngIf="group.value == 'grid' && !isLoadingBis">
            <ul class="mdc-image-list mdc-image-list--masonry my-masonry-image-list">
              <li class="mdc-image-list__item" *ngFor="let food of foodList">
                <img class="mdc-image-list__image"
                  src="https://material-components.github.io/material-components-web-catalog/static/media/photos/2x3/2.jpg">
                <div class="mdc-image-list__supporting">
                  <span class="mdc-image-list__label">{{food.name}}</span>
                </div>
              </li>
            </ul>
          </div>
        </div>
        <p class="info-text" *ngIf="foodList.length <= 0 && !isLoadingBis">No floor added yet</p>

      </ng-template>
    </mat-tab>

  </mat-tab-group>
  <p class="info-text" *ngIf="floors.length <= 0 && !isLoading">No floor added yet</p>

</div>
